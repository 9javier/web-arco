<ion-content padding="true">

  <suite-breadcrumb [post]="postRoute"></suite-breadcrumb>

  <div *ngIf="templateOpened.active" class="warning-template-active">
    <p>La plantilla aplicada al sorter no puede ser modificada.</p>
  </div>

  <ion-grid class="grid-list-zones">
    <div class="container" *ngIf="zones">
      <mat-table #table [dataSource]="zones">
        <ng-container matColumnDef="delete" [formGroup]="selectedForm" *ngIf="equalParts === 'false'">
          <mat-header-cell *matHeaderCellDef class="custom-col col-select-del">
            <ion-checkbox (ionChange)="selectAll($event)" [disabled]="templateOpened.active"></ion-checkbox>
            <i class="material-icons">delete</i>
          </mat-header-cell>

          <mat-cell *matCellDef="let element; let i = index" class="custom-col col-select-del">
            <ng-template [ngIf]="selectedForm['controls']?.toSelect">
              <ion-checkbox (click)="toDeleteZone($event, i)" [formControl]="selectedForm['controls']?.toSelect['controls'][i]" [disabled]="templateOpened.active">
              </ion-checkbox>
            </ng-template>
          </mat-cell>
        </ng-container>
        <ng-container matColumnDef="Ntemplate">
          <mat-header-cell *matHeaderCellDef class="custom-col col-id">Zona</mat-header-cell>
          <mat-cell *matCellDef="let element" class="custom-col col-id">{{element.zoneNumber}}</mat-cell>
        </ng-container>
        <ng-container matColumnDef="nombre">
          <mat-header-cell *matHeaderCellDef class="custom-col col-name">Nombre</mat-header-cell>
          <mat-cell *matCellDef="let element" class="custom-col col-name" (click)="update(element)">
            {{element.name}}
            <i class="material-icons">edit</i>
          </mat-cell>
        </ng-container>
        <ng-container matColumnDef="warehoures">
          <mat-header-cell *matHeaderCellDef class="custom-col col-stores">Tiendas</mat-header-cell>
          <mat-cell  *matCellDef="let element" class="custom-col col-stores">
            <span>
              <i matTooltip="Seleccionar tienda" matTooltipClass="tooltip" (click)="openWarehousesModal(element.id)" class="material-icons">store_mall_directory</i>
            </span>
          </mat-cell>
        </ng-container>
        <ng-container matColumnDef="color">
          <mat-header-cell *matHeaderCellDef class="custom-col col-color">Color asignado</mat-header-cell>
          <mat-cell *matCellDef="let element" class="custom-col col-color">
            <div class="color-zone">
              <div [ngStyle]="{'background-color': element.color.hex}">
                <span>
                  {{ element.color.name }}
                </span>
              </div>
            </div>
          </mat-cell>
        </ng-container>
        <ng-container matColumnDef="quantity">
          <mat-header-cell *matHeaderCellDef class="custom-col col-ways-qty">NÂº Calles</mat-header-cell>
          <mat-cell *matCellDef="let element" class="custom-col col-ways-qty"> {{element.quantity}} </mat-cell>
        </ng-container>
        <ng-container matColumnDef="updateCarriles">
          <mat-header-cell *matHeaderCellDef class="custom-col col-ways-edit"> Actualizar calles</mat-header-cell>
          <mat-cell *matCellDef="let element" class="custom-col col-ways-edit">
            <mat-radio-group name="rails">
              <mat-radio-button (click)="displayRailsRadio(element);  matrixSelectWay.changeZone(element)"
                value="element.id"></mat-radio-button>
            </mat-radio-group>
          </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns;" matRipple class="element-row"
          [class.expanded]="expandedElement == row"></mat-row>
        <mat-row *matRowDef="let row; when: isExpansionDetailRow"
          [@detailExpand]="row.element == expandedElement && showExpasion ? 'expanded' : 'collapsed'"
          style="overflow: hidden">
        </mat-row>
      </mat-table>
    </div>

    <suite-matrix-select-way-sorter
      class="matrix-box"
      [height]="'50%'"
      [waysMatrix]="waysMatrix"
      [equalParts]="equalParts" *ngIf="waysMatrix.length > 0">
    </suite-matrix-select-way-sorter>

  </ion-grid>

  <ion-fab vertical="bottom" horizontal="end">
    <div *ngIf="!templateOpened.active && !templateOpened.equalParts" style="float: left;">
      <ion-fab-button style="padding: 5px;" *ngIf="selectedForm.valid && selectedForm['controls']?.toSelect" color="danger" (click)="delete()">
        <ion-icon name="trash"></ion-icon>
      </ion-fab-button>
    </div>

    <div *ngIf="validSave" style="float: left;">
      <ion-fab-button *ngIf="!templateOpened.active && zoneId && (templateOpened.equalParts || (!templateOpened.equalParts && matrixSelectWay.getBanSave()))" style="float: right; padding: 5px;" (click)="storeWays(matrixSelectWay.getWays())">
        <ion-icon name="save"></ion-icon>
      </ion-fab-button>
    </div>

    <ion-fab-button *ngIf="!templateOpened.active && !templateOpened.equalParts" style="float: right; padding: 5px;" (click)="store()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
