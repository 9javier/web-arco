<div class="content">
  <!-- Header with info about the product scanned -->
  <div class="product-scanned" *ngIf="processStarted && productScanned && !needScanNewPacking">
    <ion-grid>
      <ion-row>
        <ion-col>{{ productScanned.model?.reference }}</ion-col>
        <ion-col></ion-col>
        <ion-col>{{ productScanned.size ? 'T: ' + productScanned.size.name : '' }}</ion-col>
      </ion-row>
      <ion-row>
        <ion-col>{{ productScanned.reference }}</ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <div class="product-scanned" *ngIf="processStarted && packageScanned && !needScanNewPacking">
    <ion-grid>
      <ion-row>
        <ion-col>Pedido: {{ packageScanned.product?.id }}</ion-col>
        <ion-col></ion-col>
      </ion-row>
      <ion-row>
        <ion-col>Bulto: {{ packageScanned.uniqueCode }}</ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Header with the destiny for the packing to scan -->
  <div class="product-scanned new-packing-scan" *ngIf="needScanNewPacking">
    <p>Nuevo embalaje para <b>{{ destinyCodeToGetPacking == 'incidence' ? 'INCIDENCIAS' : destinyCodeToGetPacking }}</b></p>
    <ng-container [ngTemplateOutlet]="cancelPackingScanBtnTemplate"></ng-container>
  </div>

  <!-- Block to show when the product scanned has a destiny assigned and the destiny has a way assigned in sorter -->
  <div class="content-destiny-color" *ngIf="processStarted && productScanned && !isWaitingWayWillFree && !productScanWithException">
    <div class="content-color" [ngStyle]="{'background-color': sorterProvider.colorSelected.hex}">
      <div class="content-labels">
        <div id="label-reference" class="label-destiny main-text">{{productScanned.destinyWarehouse.reference}}</div>
        <div id="label-name" class="label-destiny info-text">{{productScanned.destinyWarehouse.name}}</div>
      </div>
    </div>
  </div>

  <!-- Block to show when the package scanned has a destiny assigned and the destiny has a way assigned in sorter -->
  <div class="content-destiny-color" *ngIf="processStarted && packageScanned && !isWaitingWayWillFree && !productScanWithException">
    <div class="content-color" [ngStyle]="{'background-color': sorterProvider.colorSelected.hex}">
      <div class="content-labels">
        <div id="label-reference" class="label-destiny main-text">{{packageScanned.destinyWarehouse.reference}}</div>
        <div id="label-name" class="label-destiny info-text">{{packageScanned.destinyWarehouse.name}}</div>
      </div>
    </div>
  </div>

  <!-- Block to show when the product scanned has a origin scan but the destiny does not have a way assigned in sorter -->
  <div class="content-destiny-color" *ngIf="processStarted && productScanned && productScanWithException && !needScanNewPacking">
    <ng-container [ngTemplateOutlet]="closeBtnTemplate"></ng-container>
    <div class="content-color">
      <div class="content-labels">
        <div class="label-destiny main-text">{{productScanned.destinyWarehouse.reference}}</div>
        <div class="label-destiny info-text">{{productScanned.destinyWarehouse.name}}</div>
      </div>
    </div>
  </div>

  <!-- Block to show when the product scanned does not have a origin scan -->
  <div class="content-destiny-color" *ngIf="processStarted && !productScanned && productScanWithException && !needScanNewPacking">
    <ng-container [ngTemplateOutlet]="closeBtnTemplate"></ng-container>
    <div class="content-color">
      <div class="content-labels">
        <div class="label-destiny info-text">ARTÍCULO SIN ESCANEO DE SALIDA</div>
      </div>
    </div>
  </div>

  <!-- Block to show when the assigned way is busy for another user -->
  <div *ngIf="isWaitingWayWillFree" class="waiting-way-free">
    <div>
      <p class="wait-msg">¡¡ ESPERE !!</p>
      <p>COMPROBANDO CALLES LIBRES DONDE TRABAJAR</p>
      <ion-spinner name="dots"></ion-spinner>
    </div>
  </div>

  <!-- Message to show at start when need that the user scan a new product and messages showed as guide during the process -->
  <div class="start-message-guide" (click)="focusToInput()" *ngIf="!inputValue && !processStarted">
    <span>¡Hola </span><div class="color-selected" [ngStyle]="{'background-color': sorterProvider.colorSelected ? sorterProvider.colorSelected.hex : '#000'}"></div><span>!</span>
    <br/>
    <span>Escanea un artículo</span>
    <br/>
    <span>para comenzar</span>
  </div>
  <p class="message-guide" (click)="focusToInput()" *ngIf="!inputValue && processStarted && !productScanned && !productScanWithException">{{messageGuide}}</p>

  <!-- Input where set the new code -->
  <input hideKeyboard *ngIf="(!productScanned && !productScanWithException) || needScanNewPacking" id="input" class="input-sorter" (keyup)="keyUpInput($event)" (focus)="onFocus($event)" [(ngModel)]="inputValue">
</div>

<!-- Actions to show when the product scanned has a destiny assigned and the destiny has a way assigned in sorter -->
<ion-footer *ngIf="processStarted && productScanned && !productScanWithException">
  <ion-button [disabled]="isWaitingWayWillFree" expand="full" color="danger" (click)="wrongWay()">
    <p>CARRIL EQUIV.</p>
  </ion-button>
  <ion-button expand="full" color="dark" (click)="presentScannerRackModal()">
    <p>SALTAR SORTER</p>
  </ion-button>
  <ion-button [disabled]="isWaitingWayWillFree" expand="full" color="dark" (click)="fullWay()">
    <p>NO CABE CAJA</p>
  </ion-button>
</ion-footer>

<ion-footer *ngIf="processStarted && packageScanned && !productScanWithException">
  <ion-button [disabled]="isWaitingWayWillFree" expand="full" color="danger" (click)="wrongWay()">
    <p>CARRIL EQUIV.</p>
  </ion-button>
  <ion-button expand="full" color="dark" (click)="presentScannerRackModal()">
    <p>SALTAR SORTER</p>
  </ion-button>
  <ion-button [disabled]="isWaitingWayWillFree" expand="full" color="dark" (click)="fullWay()">
    <p>NO CABE CAJA</p>
  </ion-button>
</ion-footer>

<!-- Actions to show when the product scanned has a origin scan but the destiny does not have a way assigned in sorter -->
<ion-footer *ngIf="processStarted && productScanned && productScanWithException && !needScanNewPacking" class="footer-exception">
  <ion-button expand="full" color="dark" *ngIf="destiniesWithPacking[productScanned.destinyWarehouse.reference]" (click)="assignToPacking(destiniesWithPacking[productScanned.destinyWarehouse.reference])">
    <p>EMBALAJE A {{productScanned.destinyWarehouse.reference}} {{getPackingScanned(productScanned.destinyWarehouse.reference)}}</p>
  </ion-button>
  <ion-button expand="full" color="dark" class="other-btn" (click)="scanPacking(productScanned.destinyWarehouse.reference)">
    <p>{{destiniesWithPacking[productScanned.destinyWarehouse.reference] ? 'OTRO' : ('NUEVO EMBALAJE A ' + productScanned.destinyWarehouse.reference)}}</p>
  </ion-button>
</ion-footer>

<!-- Actions to show when the product scanned does not have a origin scan -->
<ion-footer *ngIf="processStarted && !productScanned && productScanWithException && !needScanNewPacking">
  <ion-button expand="full" color="dark" [disabled]="!destiniesWithPacking['000']" (click)="assignToPacking(destiniesWithPacking['000'])">
    <p>EMBALAJE A 000 {{getPackingScanned('000')}}</p>
  </ion-button>
  <ion-button expand="full" color="dark" (click)="scanPacking('000')">
    <p>NUEVO EMBALAJE A 000</p>
  </ion-button>
</ion-footer>

<!-- Template for close button that show at top-right that reset the scan process -->
<ng-template #closeBtnTemplate>
  <i class="material-icons btn-cancel" (click)="resetLastScanProcess()">close</i>
</ng-template>

<!-- Template for close button that show at top-right that cancel scan of packing process -->
<ng-template #cancelPackingScanBtnTemplate>
  <i class="material-icons btn-cancel cancel-packing" (click)="cancelScanPacking()">close</i>
</ng-template>
