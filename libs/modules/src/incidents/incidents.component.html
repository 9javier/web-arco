<ion-content>
<form [formGroup]="incidenceForm">
  <ng-container *ngIf="!readed;else read">
    <scanner-manual  (newValue)=newValue($event)  placeholder="PRODUCTO"></scanner-manual>
  </ng-container>
  <ng-template #read>
    <ion-item>
      <ion-label>Fecha</ion-label>
      <ion-datetime formControlName="dateDetection" picker-format="DD -MM-YYYY" display-format="DD-MM-YYYY" format [disabled]="barcodeRoute!=null"></ion-datetime>
    </ion-item>
    <ion-item>
      <ion-label class="ion-text-capitalize">defecto</ion-label>
      <ion-select (ionChange)="defectChange($event)" formControlName="defectType" placeholder="Selecciona" [disabled]="barcodeRoute!=null">
        <ion-select-option *ngFor="let defect of defects" [value]="defect.id">{{defect.name +" - "+ defect.defectTypeParent.name}}</ion-select-option>
      </ion-select>
    </ion-item>
    <ion-item>
      <ion-label class="ion-text-capitalize">observaciones:</ion-label>
      <ion-input formControlName="observations" type="text" [readonly]="barcodeRoute!=null"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label>Estado de gestion</ion-label>
      <ion-select *ngIf="barcodeRoute==null"  (ionChange)="gestionChange($event)" placeholder="Selecciona" [disabled]="barcodeRoute!=null">
        <ion-select-option  *ngFor="let item of statusManagament.statuses" [value]="item.id" >{{item.name}}</ion-select-option>
      </ion-select>
      <ion-select *ngIf="barcodeRoute!=null" placeholder="Selecciona" formControlName="gestionState" #typeID (ionChange)="onChange(typeID.value); gestionChange($event)">
        <ion-select-option  *ngFor="let item of types" [value]="item.id || 01" >{{item.name || Hola}}</ion-select-option>
      </ion-select>
    </ion-item>
  

     <ion-item *ngIf="passHistory == true">
      <ion-label class="ion-text-capitalize">pasar a historial</ion-label>
      <ion-checkbox formControlName="isHistory" slot="end"></ion-checkbox>
    </ion-item>

   
    <div *ngIf="requireContact == true" class="contact">
      <div formGroupName = "contact">
        <ion-item lines="none">
          <ion-label class="ion-text-capitalize">Contacto</ion-label><br>
        </ion-item>
       <ion-item lines="none">
         <ion-input type="text"   formControlName="name" (keyup)="onKeyName($event)" placeholder="Nombre" maxlength="15"></ion-input><br>
       </ion-item>
       <ion-item lines="none">
         <ion-input type="email" formControlName="email" (keyup)="onKeyEmail($event)" placeholder="Correo" maxlength="20"></ion-input><br>
       </ion-item>
       <ion-item lines="none">
         <ion-input type="number" formControlName="phone" (keyup)="onKeyTel($event)" placeholder="TelÃ©fono" maxlength="12"></ion-input>
       </ion-item>
      </div>
    </div>

      <!--<ion-item lines="none" *ngIf="passHistory == true">
        <ion-label class="ion-text-capitalize">pasar a historial</ion-label>
        <ion-checkbox formControlName="isHistory" slot="end"></ion-checkbox>
      </ion-item>-->
  
    
  
  
      <ion-item lines="none" *ngIf="requirePhoto == true" lines="none">
        <ion-label class="ion-text-capitalize">capturar / buscar fotos</ion-label>
        <ion-button (click)="takePhoto()">
          <ion-icon name="camera"></ion-icon>
        </ion-button>
        <ion-button (click)="searchPhoto()">
          <ion-icon name="images"></ion-icon>
        </ion-button>
      </ion-item>
      <ion-item *ngIf="requirePhoto == true" (click)="openPhotoList()" lines="none">
        <ion-label>Fotos</ion-label>
        <ion-icon slot="end" *ngIf="photoList" name="arrow-down"></ion-icon>
        <ion-icon slot="end" *ngIf="!photoList" name="arrow-up"></ion-icon>
      </ion-item>
      <ion-list *ngIf="photoList && requirePhoto">
        <ion-item  lines="none" *ngFor="let item of photos; let i = index">
          <ion-img (click)="onOpenReviewModal(item)" slot="end" [src]="item.pathIcon"></ion-img>
            <ion-button (click)="deleteImage(item, i, photos)">
              <ion-icon slot="icon-only" name="trash"></ion-icon>
            </ion-button>
        </ion-item>
      </ion-list>
      <ion-item lines="none">
        <ion-label class="ion-text-capitalize">retorno fabrica</ion-label>
        <ion-checkbox formControlName="factoryReturn" slot="end" [readonly]="barcodeRoute!=null"></ion-checkbox>
      </ion-item>
  
      <ion-item lines="none" *ngIf="requireOk == true">
        <ion-label lines="none" class="ion-text-capitalize">generar firma</ion-label>
        <ion-button (click)="signModal()">
          <ion-icon name="finger-print"></ion-icon>
        </ion-button>
      </ion-item>
      <ion-item *ngIf="requireOk == true" (click)="openSignatureList()" lines="none">
        <ion-label>Firmas</ion-label>
        <ion-icon slot="end" *ngIf="signatureList" name="arrow-down"></ion-icon>
        <ion-icon slot="end" *ngIf="!signatureList" name="arrow-up"></ion-icon>
      </ion-item>
      <ion-list  *ngIf="signatureList && requireOk">
        <ion-item lines="none" *ngFor="let item of signatures; let i = index">
          <ion-img (click)="onOpenReviewModal(item)" slot="start" [src]="item.pathIcon"></ion-img>
          <ion-button slot="end" (click)="deleteImage(item, i, signatures)">
            <ion-icon slot="icon-only" name="trash"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>
      <!-- <ion-label>{{imgUrl}}</ion-label> -->
    
   <!-- <ion-item>
      <ion-label class="ion-text-capitalize">retorno fabrica</ion-label>
      <ion-checkbox  formControlName="factoryReturn" slot="end" [readonly]="barcodeRoute!=null"></ion-checkbox>
    </ion-item>-->

    <!--<ion-item *ngIf="requireOk == true">
      <ion-label class="ion-text-capitalize">Firma</ion-label>
      <ion-button (click)="signModal()"><ion-icon name="finger-print-outline"></ion-icon></ion-button>
    </ion-item>-->

   

    <ion-button *ngIf="barcodeRoute==null" (click)="send()" expand="block" shape="round">
      enviar
    </ion-button>
    
    <ion-button *ngIf="barcodeRoute!=null" [disabled]="differentState" (click)="enviaryarn()" expand="block" shape="round" >
      actualizar
    </ion-button>
 
  </ng-template>
</form>
</ion-content>