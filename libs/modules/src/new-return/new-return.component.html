<ion-content>
  <ion-grid *ngIf="return">
    <ion-row>
      <ion-col size="8">
        <ion-item>
          <ion-label position="stacked">ID</ion-label>
          <ion-input disabled>{{return.id == 0 ? 'Este campo se rellenará automáticamente al guardar.' : return.id}}</ion-input>

          <ion-button slot="end" class="btn-select-unities" [disabled]="!return.id || isHistoric" (click)="selectUnitiesItems()">Seleccionar unidades</ion-button>
        </ion-item>
      </ion-col>

      <ion-col size="4" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Último estado</ion-label>
          <ion-input disabled>{{getStatusName(return.lastStatus)}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="4">
        <ion-item [disabled]="isHistoric" (click)="openShowSelectableList(1)" class="item-selectable">
          <ion-label>Tipo *</ion-label>
          <ion-label>{{return.type ? return.type.name : ''}}</ion-label>
          <ion-icon name="ios-arrow-forward" slot="end"></ion-icon>
        </ion-item>
      </ion-col>

      <ion-col size="4">
        <ion-item [disabled]="isHistoric" (click)="openShowSelectableList(2)" class="item-selectable">
          <ion-label>Almacén *</ion-label>
          <ion-label>{{return.warehouse ? return.warehouse.name : ''}}</ion-label>
          <ion-icon name="ios-arrow-forward" slot="end"></ion-icon>
        </ion-item>
      </ion-col>

      <ion-col size="4">
        <ion-item [disabled]="isHistoric">
          <ion-label position="stacked">Cambiar estado</ion-label>
          <ion-select [selectedText]="''" placeholder="Seleccione un nuevo estado" (ionChange)="changeStatus($event.detail.value)">
            <ion-select-option *ngFor="let status of [1,2,3,4,5,6,7]" [value]="status">{{getStatusName(status)}}</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="4">
        <ion-row class="no-padding">
          <ion-col class="no-padding">
            <ion-item [disabled]="isHistoric" (click)="openShowSelectableList(3)" class="item-selectable">
              <ion-label>Proveedor *</ion-label>
              <ion-label>{{return.provider ? return.provider.name : ''}}</ion-label>
              <ion-icon name="ios-arrow-forward" slot="end"></ion-icon>
            </ion-item>
          </ion-col>
          <ion-col class="no-padding center-contents" *ngIf="thereAreConditions()" size="3">
            <ion-button [disabled]="isHistoric" (click)="selectCondition()">Condiciones</ion-button>
          </ion-col>
        </ion-row>
      </ion-col>

      <ion-col size="4">
        <ion-item [disabled]="isHistoric">
          <ion-label position="stacked">Marcas *</ion-label>
          <ion-input *ngIf="!return.provider" disabled placeholder="Debe seleccionar un proveedor"></ion-input>
          <ion-select *ngIf="return.provider" [interfaceOptions]="{cssClass: 'wide-alert'}" [selectedText]="return.brands ? getBrandNameList(return.brands) : ''" placeholder="Seleccione las marcas" multiple (ionChange)="return.brands = $event.detail.value">
            <ion-select-option *ngFor="let brand of return.provider.brands" [value]="brand">{{brand.name}}</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>

      <ion-col size="4" class="disabled-col">
        <ion-item class="item-date">
          <ion-label position="stacked">Fecha último estado</ion-label>
          <ion-input disabled>{{return.dateLastStatus ? formatDate(return.dateLastStatus) : 'Esta fecha se rellenará automáticamente'}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="4">
        <ion-item>
          <ion-label position="stacked">Correo de contacto</ion-label>
          <ion-input [disabled]="isHistoric" [(ngModel)]="return.email"></ion-input>
        </ion-item>
      </ion-col>

      <ion-col size="4">
        <ion-item class="item-date" [disabled]="isHistoric">
          <ion-label position="stacked">Devolver antes de *</ion-label>
          <input matInput [matDatepicker]="pickerDateReturnBefore" [(ngModel)]="return.dateReturnBefore" placeholder="Seleccione una fecha">
          <mat-datepicker-toggle matSuffix [for]="pickerDateReturnBefore"></mat-datepicker-toggle>
          <mat-datepicker #pickerDateReturnBefore></mat-datepicker>
        </ion-item>
      </ion-col>

      <ion-col size="4" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Usuario</ion-label>
          <ion-input disabled>{{return.user.name}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item [disabled]="isHistoric">
          <ion-label position="stacked">Observaciones</ion-label>
          <ion-textarea rows="6" cols="20" placeholder="Introduzca aquí sus observaciones" [(ngModel)]="return.observations" type="text"></ion-textarea>
        </ion-item>
      </ion-col>
    </ion-row>

    <mat-divider></mat-divider>

    <ion-row>
      <ion-col size="4" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Jaulas contenedoras</ion-label>
          <ion-input disabled>{{return.packings}}</ion-input>
        </ion-item>
      </ion-col>

      <ion-col size="4">
        <ion-item>
          <ion-label position="stacked">Nº Bultos</ion-label>
          <ion-input [disabled]="isHistoric" [(ngModel)]="return.amountPackages"></ion-input>
        </ion-item>
      </ion-col>

      <ion-col size="4">
        <ion-item class="item-date" [disabled]="isHistoric">
          <ion-label position="stacked">Fecha prevista de recogida</ion-label>
          <input matInput [matDatepicker]="pickerDatePredictedPickup" [(ngModel)]="return.datePredictedPickup">
          <mat-datepicker-toggle matSuffix [for]="pickerDatePredictedPickup"></mat-datepicker-toggle>
          <mat-datepicker #pickerDatePredictedPickup></mat-datepicker>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="4">
        <ion-item>
          <ion-label position="stacked">Agencia transportista</ion-label>
          <ion-input [disabled]="isHistoric" [(ngModel)]="return.shipper"></ion-input>
        </ion-item>
      </ion-col>

      <ion-col size="4">
        <ion-item>
          <div class="div-btn-item">
            <ion-button matTooltip="Adjuntar albarán de agencia" matTooltipClass="tooltip" slot="start" fill="clear" [disabled]="!return || !return.id || isHistoric" (click)="searchDelivery_note()">
              <ion-icon name="image" slot="start"></ion-icon> albarán agencia
            </ion-button>
          </div>
        </ion-item>
      </ion-col>

      <ion-col size="4" class="disabled-col">
        <ion-item class="item-date">
          <ion-label position="stacked">Fecha de recogida</ion-label>
          <ion-input disabled>{{return.datePickup ? formatDate(return.datePickup): 'Esta fecha se rellenará más adelante'}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <div>
          <ion-item *ngIf="this.archives?.length > 0" (click)="showArchiveList()" lines="none">
            <ion-label class="label-text">Archivos</ion-label>
            <ion-icon slot="end" *ngIf="displayArchiveList" name="arrow-down"></ion-icon>
            <ion-icon slot="end" *ngIf="!displayArchiveList" name="arrow-up"></ion-icon>
          </ion-item>
          <ion-list *ngIf="archiveList && displayArchiveList">
            <ion-item lines="none" *ngFor="let item of archives; let i = index">
              <ion-img (click)="openReviewImage(item)" slot="start" [src]="baseUrlPhoto + item.pathIcon"></ion-img>
              <ion-button slot="end" (click)="deleteImage(item, i, archives)">
                <ion-icon slot="icon-only" name="trash"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-list>
          <ion-item *ngIf="this.delivery_notes?.length > 0" (click)="showDeliveryNoteList()" lines="none">
            <ion-label class="label-text">Albaranes de Agencia</ion-label>
            <ion-icon slot="end" *ngIf="displayDeliveryNoteList" name="arrow-down"></ion-icon>
            <ion-icon slot="end" *ngIf="!displayDeliveryNoteList" name="arrow-up"></ion-icon>
          </ion-item>
          <ion-list *ngIf="delivery_noteList && displayDeliveryNoteList">
            <ion-item lines="none" *ngFor="let item of delivery_notes; let i = index">
              <ion-img (click)="openReviewImage(item)" slot="start" [src]="baseUrlPhoto + item.pathIcon"></ion-img>
              <ion-button slot="end" (click)="deleteImage(item, i, delivery_notes)">
                <ion-icon slot="icon-only" name="trash"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-list>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-button matTooltip="Imprimir/enviar albarán" matTooltipClass="tooltip" slot="start" fill="clear" [disabled]="true || isHistoric"><ion-icon name="print" slot="start"></ion-icon> albarán</ion-button>
    <ion-button matTooltip="Adjuntar archivos/imágenes" matTooltipClass="tooltip" slot="start" fill="clear" [disabled]="!return || !return.id || isHistoric" (click)="searchArchive()"><ion-icon name="attach" slot="start"></ion-icon> archivos/imágenes</ion-button>

    <ion-button *ngIf="!isHistoric" slot="end" color="light" (click)="router.navigateByUrl('/return-tracking-list')">Cancelar</ion-button>
    <ion-button *ngIf="isHistoric" slot="end" color="light" (click)="router.navigateByUrl('/returns-historic')">Cancelar</ion-button>
    <ion-button slot="end" color="primary" [disabled]="!allFieldsFilled() || isHistoric" (click)="save()">Guardar</ion-button>
  </ion-toolbar>
</ion-footer>
