<ion-content padding="true">
    <suite-breadcrumb></suite-breadcrumb>
    <ion-grid>
        <ion-row>
            <ion-col size="6">
                <ion-button color="danger" *ngIf="selectDates.length > 1" (click)="clear()">clear</ion-button>
            </ion-col>
            <ion-col size="6" [formGroup]="template">
                <ion-item>
                    <ion-label>
                        Plantilla
                    </ion-label>
                    <ion-select formControlName="template" (ionChange)="selectTemplate(templates[$event.detail.value],null)">
                        <ion-select-option *ngFor="let template of templates;let i = index" [value]="i">
														{{template.name}}
												</ion-select-option>
                    </ion-select>
                </ion-item>

            </ion-col>
            <ion-col size="6" class="ion-datepicker">
                <div class="append">
                    <dp-date-picker [(ngModel)]="dates" [config]="calendarConfiguration"></dp-date-picker>
                </div>
                <div class="legend">
                    <span style="color:#2196f3">
                        Datos almacenados
                    </span>,
                    <span style="color:#008000">
                        Hay información
                    </span>,
                    <span style="color:#ea5348">
                        No hay información
                    </span>


                </div>
            </ion-col>
            <ion-col size="6">
                <div *ngIf="!formatValue(form.value).warehouses.length" class="error">
                    Debe seleccionar al menos un destino
                </div>
                <div *ngIf="!date && formatValue(form.value).warehouses.length" class="warning">
                    Debe seleccionar al menos una fecha para almacenar
                </div>

                <ion-item *ngIf="selectDates.length">
                    <ion-label>
                        Fechas
                    </ion-label>
                    <ion-select *ngIf="!loadingDates" [compareWith]="compareDate" [(ngModel)]="modelDate" (ionChange)="selectTemplate($event.detail.value,$event.detail.value.value,$event.detail.value)">
                        <div *ngFor="let date of selectDates">
                            <ion-select-option [value]="date">{{date.date}}</ion-select-option>
                        </div>
                    </ion-select>
                </ion-item>
                <div class="overAuto" [formGroup]="form">
                    <mat-accordion multi="false" *ngFor="let warehouse of form['controls']?.warehouses['controls'];let i = index">
                        <mat-expansion-panel (opened)="openeds[i] = true" (closed)="openeds[i] = false">
                            <mat-expansion-panel-header>
                                <ion-grid>
                                    <ion-row>
                                        <ion-col size="3">
                                            <mat-panel-title>
                                                {{ warehouse.value.originWarehouse.name }}
                                            </mat-panel-title>
                                        </ion-col>
                                        <ion-col size="7">
                                            <mat-panel-description></mat-panel-description>
                                        </ion-col>
                                        <ion-col size="1">
                                        </ion-col>
                                    </ion-row>
                                </ion-grid>

                            </mat-expansion-panel-header>

                            <div *ngIf="openeds[i]">
                                <ion-col size="2" size-xs="12" size-md="4">
																	<ion-label>
																			Almacenes
																	</ion-label>
																	<suite-tags-input placeholder="Almacenes" [options]="warehouses" formControlName="warehousesInput" multiple="false"></suite-tags-input>
																</ion-col>
																<div [formGroup]="destination" class="no-border" *ngFor="let destination of warehouse['controls'].destinationsWarehouses['controls']">
																		<ion-item *ngIf="destination.value.selected">
																			<ion-label *ngIf="destination.value.selected" slot="end" class="deleteWarehouse" (click)="deletedWarehouseOfTemplate(destination.value.id, warehouse.value.originWarehouse.id)">X</ion-label>
																			<ion-label *ngIf="destination.value.selected">{{destination.value.name}}</ion-label>
																		</ion-item>
																</div>
                            </div>
                            <mat-list style="display: flex; justify-content:center;"></mat-list>
                        </mat-expansion-panel>
                    </mat-accordion>
                </div>
            </ion-col>
        </ion-row>
    </ion-grid>
</ion-content>
<ion-footer>
    <ion-button [disabled]="!date || !validToStore() " (click)="store()">GUARDAR</ion-button>
    <ion-button [disabled]="!formatValue(form.value).warehouses.length" (click)="storeTemplate(formatValue(form.value))">PLANTILLA</ion-button>
    <ion-button *ngIf="formatValue(form.value).warehouses.length" color="danger" (click)="clearData()">
        <ion-icon name="trash"></ion-icon> CLEAR
    </ion-button>
</ion-footer>