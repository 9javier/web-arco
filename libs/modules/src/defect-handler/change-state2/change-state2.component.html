<ion-header>
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-button matTooltip="Cerrar" matTooltipClass="tooltip" (click)="close()">
                <ion-icon name="close" class="toogleArrow"></ion-icon>
            </ion-button>
        </ion-buttons>
        <ion-title>{{ registry?.data?.warehouse?.reference }}/{{registry?.data?.warehouseDefectIdentifier}}</ion-title>
    </ion-toolbar>
</ion-header>
<ion-content >
  <form [formGroup]="incidenceForm">
  <ion-item>
    <ion-label class="label-text">Producto:</ion-label>
    <ion-input class="input-barcode" type="text" readonly>{{registry.data.product.reference}}</ion-input><br>
  </ion-item>
  <ion-item>
    <ion-label class="label-text">Fecha</ion-label>
    <ion-datetime formControlName="dateDetection" picker-format="DD/MM/YYYY" display-format="DD/MM/YYYY" format disabled></ion-datetime>
  </ion-item>

  <ion-item (click)="clickSelectPopover($event)">
    <ion-label class="label-text">Estado de gestion</ion-label>
    <ion-label class="content-select" style="text-align: center" *ngIf="!defectStatus"><font color="#808080">Selecciona</font> <i></i></ion-label>
    <ion-label class="content-select" style="text-align: center" *ngIf="defectStatus">{{ defectStatus.name }} <i></i></ion-label>
  </ion-item>

  <ion-item>
    <ion-label class="ion-text-capitalize label-text">defecto</ion-label>
    <ion-input style="margin-left: 5%;" disabled>{{ ParentAndChild }}</ion-input>
    <!--<ion-select (ionChange)="defectChange($event)" placeholder="Selecciona" disabled>
      <ion-select-option >{{ ParentAndChild }}</ion-select-option>
    </ion-select> -->
  </ion-item>

  <ion-item>
    <ion-label class="ion-text-capitalize label-text">Zona</ion-label>
    <ion-input style="margin-left: 10%;" disabled>{{ ZoneAndChild }}</ion-input>
  </ion-item>




  <ion-item *ngIf="selectGestionState == true">
    <ion-label position="floating" class="label-text">Observaciones</ion-label>
    <ion-textarea  formControlName="observations" type="text" [readonly]="barcodeRoute!=null"></ion-textarea>
  </ion-item>

  <div *ngIf="requireContact == true && selectGestionState == true" class="contact">
    <div formGroupName = "contact">
      <ion-item lines="none">
        <ion-label class="ion-text-capitalize label-text">Contacto</ion-label><br>
      </ion-item>
     <ion-item lines="none">
       <ion-input type="text" formControlName="name"  (keyup)="onKeyName($event)" placeholder="Nombre" maxlength="50"></ion-input><br>
     </ion-item>
     <ion-item lines="none">
       <ion-input type="text" formControlName="info" (keyup)="onKeyInfo($event)" placeholder="Tlf./Email"></ion-input><br>
     </ion-item>
    </div>
  </div>

  <div *ngIf="selectGestionState == true">

  <ion-item lines="none" *ngIf="requirePhoto == true" lines="none">
    <ion-label class="ion-text-capitalize label-text">capturar / buscar fotos</ion-label>
    <ion-button (click)="takePhoto()" class="icon-camare">
      <ion-icon name="camera"></ion-icon>
    </ion-button>
    <ion-button (click)="searchPhoto()">
      <ion-icon name="images"></ion-icon>
    </ion-button>
  </ion-item>

  <ion-item *ngIf="requirePhoto && photoList" (click)="showPhotoList()" lines="none">
    <ion-label class="label-text">Fotos</ion-label>
    <ion-icon slot="end" *ngIf="displayPhotoList" name="arrow-down"></ion-icon>
    <ion-icon slot="end" *ngIf="!displayPhotoList" name="arrow-up"></ion-icon>
  </ion-item>
  <ion-list *ngIf="photoList && requirePhoto && displayPhotoList">
    <ion-item  lines="none" *ngFor="let item of photos; let i = index">
      <ion-img (click)="onOpenReviewModal(item)"  slot="start" [src]="item.pathIcon"></ion-img>
      <ion-button slot="end"(click)="deleteImage(item, i, photos)">
        <ion-icon slot="icon-only" name="trash"></ion-icon>
      </ion-button>
    </ion-item>
  </ion-list>
  </div>

<div *ngIf="selectGestionState == true">
  <ion-item lines="none" *ngIf="requireOk == true">
    <ion-label lines="none" class="ion-text-capitalize label-text">generar firma</ion-label>
    <ion-button (click)="signModal()">
      <ion-icon name="finger-print"></ion-icon>
    </ion-button>
  </ion-item>
  <ion-item *ngIf="signatures && requireOk == true" (click)="openSignatureList()" lines="none">
    <ion-label class="label-text">Firma</ion-label>
    <ion-icon slot="end" *ngIf="signatureList" name="arrow-down"></ion-icon>
    <ion-icon slot="end" *ngIf="!signatureList" name="arrow-up"></ion-icon>
  </ion-item>
  <ion-list  *ngIf="signatures && signatureList && requireOk">
    <ion-item lines="none">
      <ion-img (click)="onOpenReviewModal(signatures)" slot="start" [src]="signatures.pathIcon"></ion-img>
      <ion-button slot="end" (click)="deleteSignature(signatures)">
        <ion-icon slot="icon-only" name="trash"></ion-icon>
      </ion-button>
    </ion-item>
  </ion-list>
  </div>
  <!--<ion-label>{{imgUrl}}</ion-label>-->


  <ion-button  [disabled]="selectGestionState == false" (click)="send()" expand="block" shape="round">
    actualizar
  </ion-button>
  </form>
</ion-content>
