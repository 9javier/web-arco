<ion-content>
  <ion-grid *ngIf="return">
    <ion-row *ngIf="pickingAvailable()">
      <ion-col class="center-contents">
        <ion-button class="btn-start" fill="clear" (click)="startPicking()">Iniciar picking <ion-icon slot="end" name="play"></ion-icon></ion-button>
      </ion-col>
    </ion-row>
    <mat-divider class="divider-top"></mat-divider>

    <ion-row>
      <ion-col size="6">
        <ion-item>
          <ion-label position="stacked">{{requiredFields.quantityPacking ? '* ' : ''}}Nº Bultos</ion-label>
          <ion-input style="max-width: 40px; margin-left: 8px" [(ngModel)]="return.amountPackages" type="number"></ion-input>
          <ion-button slot="end" *ngIf="return.amountPackages > 0" (click)="printPackages(return)">
            <ion-icon slot="icon-only" name="print"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-col>

      <ion-col size="6">
        <ion-item class="item-date">
          <ion-label position="stacked">{{requiredFields.pickupDate ? '* ' : ''}}Fecha prevista recogida</ion-label>
          <input matInput [matDatepicker]="pickerDatePredictedPickup" [(ngModel)]="return.datePredictedPickup">
          <mat-datepicker-toggle matSuffix [for]="pickerDatePredictedPickup"></mat-datepicker-toggle>
          <mat-datepicker #pickerDatePredictedPickup></mat-datepicker>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="6">
        <ion-item>
          <ion-label position="stacked">{{requiredFields.shipper ? '* ' : ''}}Agencia transportista</ion-label>
          <ion-input [(ngModel)]="return.shipper"></ion-input>
        </ion-item>
      </ion-col>

      <ion-col size="6">
        <ion-item>
          <ion-label position="stacked">Cambiar estado</ion-label>
          <ion-select [selectedText]="''" placeholder="Nuevo estado" (ionChange)="changeStatus($event.detail.value)">
            <ion-select-option *ngFor="let status of listStatusAvailable" [value]="status.id">{{status.name}}</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="12" class="disabled-col">
        <ion-item>
          <ion-label position="stacked" color="dark">Jaulas contenedoras</ion-label>
          <ion-input disabled>{{getPackingNameList(return.packings)}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="12" class="col-delivery-note">
        <ion-button matTooltip="Añadir de albarán de agencia" fill="clear" class="button-item" (click)="searchDeliveryNote()">
          <ion-icon name="image" slot="end"></ion-icon>
          {{requiredFields.deliveryNote ? '* ' : ''}}albarán agencia
        </ion-button>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="6" class="col-delivery-note">
        <ion-button [disabled]="delivery_notes.length==0" matTooltip="Ver albaránes de agencia" fill="clear" class="button-item" (click)="viewDeliveryNote()">
          ver <ion-icon name="image" slot="end"></ion-icon><br>
        </ion-button>
      </ion-col>
      <ion-col size="6" class="col-delivery-note">
        <ion-button matTooltip="Añadir albarán de agencia" fill="clear" class="button-item" (click)="searchDeliveryNote()">
          subir <ion-icon name="image" slot="end"></ion-icon><br>
        </ion-button>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <ion-item>
          <ion-label position="stacked">Observaciones Operario</ion-label>
          <ion-textarea [(ngModel)]="return.operatorObservations"></ion-textarea>
        </ion-item>
      </ion-col>
    </ion-row>

    <mat-divider></mat-divider>

    <ion-row>
      <ion-col size="6" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">ID</ion-label>
          <ion-input disabled>{{return.id}}</ion-input>
        </ion-item>
      </ion-col>
      <ion-col size="6" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Unidades</ion-label>
          <ion-input disabled>{{return.unitsPrepared+' / '+return.unitsSelected}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="6" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Tipo</ion-label>
          <ion-input disabled>{{return.type.name}}</ion-input>
        </ion-item>
      </ion-col>
      <ion-col size="6" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Almacén</ion-label>
          <ion-input disabled>{{return.warehouse.name}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="6" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Proveedor</ion-label>
          <ion-input disabled>{{return.provider.name}}</ion-input>
        </ion-item>
      </ion-col>
      <ion-col size="6" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Marcas</ion-label>
          <ion-input disabled>{{getBrandNameList(return.brands)}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="6" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Correo de contacto</ion-label>
          <ion-input disabled>{{return.email}}</ion-input>
        </ion-item>
      </ion-col>
      <ion-col size="6" class="disabled-col">
        <ion-item class="item-date">
          <ion-label position="stacked" color="medium">Devolver antes del</ion-label>
          <ion-input disabled>{{return.dateReturnBefore ? formatDate(return.dateReturnBefore) : 'Seleccione una fecha'}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="6" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Estado</ion-label>
          <ion-input disabled>{{getStatusName(return.status)}}</ion-input>
        </ion-item>
      </ion-col>
      <ion-col size="6" class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Usuario</ion-label>
          <ion-input disabled>{{return.user.name}}</ion-input>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col class="disabled-col">
        <ion-item>
          <ion-label position="stacked">Observaciones</ion-label>
          <ion-textarea disabled [(ngModel)]="return.observations"></ion-textarea>
        </ion-item>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="12" class="col-delivery-note">
        <ion-button matTooltip="Archivos/Imágenes" fill="clear" class="button-item">
          archivos/imágenes
        </ion-button>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="6" class="col-delivery-note">
        <ion-button [disabled]="archives.length==0" fill="clear" class="button-item" (click)="viewArchive()">
          <ion-icon name="attach" slot="end"></ion-icon>
          ver
        </ion-button>
      </ion-col>
      <ion-col size="6" class="col-delivery-note">
        <ion-button fill="clear" class="button-item" (click)="searchArchive()">
          <ion-icon name="attach" slot="end"></ion-icon>
          subir
        </ion-button>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12" class="col-delivery-note">
        <ion-button (click)="takePhoto()"  fill="clear" class="button-item">
          <ion-icon name="camera" slot="end"></ion-icon>
          foto
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-row>
      <ion-col size="6" class="center-contents">
        <ion-button class="btn-cancel" fill="clear" (click)="router.navigateByUrl('/return-pending-list')">Cancelar</ion-button>
      </ion-col>
      <ion-col size="6" class="center-contents">
        <ion-button class="btn-save" color="primary" [disabled]="!allFieldsFilled()" (click)="save()">Guardar</ion-button>
      </ion-col>
    </ion-row>
  </ion-toolbar>
</ion-footer>
