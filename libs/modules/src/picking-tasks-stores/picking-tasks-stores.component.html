<div id="filters" *ngIf="filtersOpen">
  <ion-row>
    <ion-col>
      <mat-form-field class="stretch-formField">
        <mat-label>Fecha</mat-label>
        <mat-select [(value)]="filterForm.date.mode" (selectionChange)="applyFilter()">
          <mat-option value="">Todas</mat-option>
          <mat-option class="date" *ngFor="let mode of filterOptions.dateModes" value="{{mode}}">
            {{mode+' el'}}
            <mat-form-field class="example-full-width">
              <mat-label>{{filterForm.date[mode] ? filterForm.date[mode].toLocaleDateString('es-ES') : 'Selecciona una fecha'}}</mat-label>
              <input matInput [matDatepicker]="picker" [(ngModel)]="filterForm.date[mode]">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker touchUi #picker></mat-datepicker>
            </mat-form-field>
          </mat-option>
        </mat-select>
      </mat-form-field>
    </ion-col>
    <ion-col>
      <mat-form-field class="stretch-formField">
        <mat-label>Artículo</mat-label>
        <mat-select [(value)]="filterForm.article" (selectionChange)="applyFilter()">
          <mat-option value="">Todos</mat-option>
          <mat-option *ngFor="let article of filterOptions.articles" value="{{article}}">{{article}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      <mat-form-field class="stretch-formField">
        <mat-label>Marca</mat-label>
        <mat-select [(value)]="filterForm.brand" (selectionChange)="applyFilter()">
          <mat-option value="">Todas</mat-option>
          <mat-option *ngFor="let brand of filterOptions.brands" value="{{brand}}">{{brand}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ion-col>
    <ion-col>
      <mat-form-field class="stretch-formField">
        <mat-label>Talla</mat-label>
        <mat-select [(value)]="filterForm.size" (selectionChange)="applyFilter()">
          <mat-option value="">Todas</mat-option>
          <mat-option *ngFor="let size of filterOptions.sizes" value="{{size}}">{{size}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      <mat-form-field class="stretch-formField">
        <mat-label>Estado</mat-label>
        <mat-select [(value)]="filterForm.status" (selectionChange)="applyFilter()">
          <mat-option value="">Todos</mat-option>
          <mat-option *ngFor="let status of filterOptions.statuses" value="{{status}}">{{status}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ion-col>
    <ion-col>
      <mat-form-field class="stretch-formField">
        <mat-label>Tipo</mat-label>
        <mat-select [(value)]="filterForm.type" (selectionChange)="applyFilter()">
          <mat-option value="">Todos</mat-option>
          <mat-option *ngFor="let type of filterOptions.types" value="{{type}}">{{type}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      <mat-form-field class="stretch-formField">
        <mat-label>Ordenar por</mat-label>
        <mat-select [(value)]="orderBy.value" (selectionChange)="applyOrder()">
          <mat-option *ngFor="let option of orderBy.options" value="{{option}}">{{option}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ion-col>
    <ion-col>
      <mat-form-field class="stretch-formField">
        <mat-label>Sentido</mat-label>
        <mat-select [(value)]="orderBy.direction" (selectionChange)="applyOrder()">
          <mat-option *ngFor="let direction of orderBy.directions" value="{{direction}}">{{direction}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ion-col>
  </ion-row>
</div>
<ion-row *ngIf="requests.length > 0" id="topRow">
  <ion-col size="auto" class="centered-col">
    <ion-checkbox [(ngModel)]="allRequestsSelected" (ngModelChange)="selectAllRequests($event)"></ion-checkbox>
  </ion-col>
  <ion-col size="auto" class="centered-col">
    <mat-panel-title>Seleccionar todo</mat-panel-title>
  </ion-col>
  <ion-col size="auto" class="centered-col filters">
    <ion-button (click)="filtersOpen = !filtersOpen">Filtros</ion-button>
  </ion-col>
</ion-row>

<ion-content>

  <ion-progress-bar type="indeterminate" *ngIf="isLoadingData"></ion-progress-bar>

  <ion-list *ngIf="!isLoadingData && requests.length > 0">
    <ng-container *ngFor="let request of requests">
      <ion-item *ngIf="!request.hidden" [class]="request.confirmed && !request.reserved ? '' : 'unconfirmed'">
        <ion-checkbox class="lowMargin" slot="start" [(ngModel)]="request.selected" (click)="selectRequest(request.selected)"></ion-checkbox>
        <ion-label>
          <ion-row>
            <ion-col><b>Fecha:</b> {{getDate(request)}}</ion-col>
            <ion-col><b>Artículo:</b> {{request.model.reference}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col><b>Marca:</b> {{request.model.brand.name}}</ion-col>
            <ion-col><b>Talla:</b> {{request.size.name}}</ion-col>
          </ion-row>
          <ion-row>
            <ion-col><b>Estado:</b> {{getStatus(request)}}</ion-col>
            <ion-col><b>Tipo:</b> {{getType(request)}}</ion-col>
          </ion-row>
        </ion-label>
      </ion-item>
    </ng-container>
  </ion-list>

  <div *ngIf="!isLoadingData && requests.length == 0" class="msg-empty-pickings">
    <p class="msg-empty-pickings">No hay peticiones pendientes para la tienda</p>
  </div>

  <ion-footer class="footer-products">
    <ion-fab vertical="bottom" horizontal="end" class="horizontal-fab">
      <ion-fab-button matTooltip="Actualizar" matTooltipClass="tooltip" (click)="ngOnInit()">
        <i class="material-icons">refresh</i>
      </ion-fab-button>
      <ion-fab-button (click)="initPicking()" *ngIf="checkRequestSelected()">
        <i class="material-icons">play_arrow</i>
      </ion-fab-button>
    </ion-fab>
  </ion-footer>

</ion-content>
