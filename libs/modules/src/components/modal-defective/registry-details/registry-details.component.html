<ion-header>
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-button matTooltip="Cerrar" matTooltipClass="tooltip" (click)="close()">
                <ion-icon name="close" class="toogleArrow"></ion-icon>
            </ion-button>
        </ion-buttons>
        <ion-title>{{ registry.id }}</ion-title>
    </ion-toolbar>
</ion-header>
<ion-content>
    <ion-segment [(ngModel)]="section">
        <ion-segment-button value="information">
            <ion-label>Información</ion-label>
        </ion-segment-button>
        <ion-segment-button value="historical">
            <ion-label>Histórico</ion-label>
        </ion-segment-button>
    </ion-segment>

    <div *ngIf="section == 'information'">
        <ion-list class="ion-padding">
          <ion-item>
            <ion-label>
              Usuario: {{registry?.user?.name}}
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              Almacén: {{registry?.warehouse ? (registry?.warehouse.reference + " - " + registry?.warehouse.name) : ""}}
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              Modelo: {{registry?.product?.model?.reference}}
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              Talla: {{registry?.product?.size?.name}}
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              Marca: {{registry?.product?.model?.brand?.name}}
            </ion-label>
          </ion-item>
          <ion-item *ngIf="registry?.factoryReturn">
            <ion-label>
              Color: {{registry?.product?.model?.color?.name}}
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              Producto: {{registry?.product?.reference}}
            </ion-label>
          </ion-item>
          <ion-item *ngIf="registry?.factoryReturn">
            <ion-label>
              Devolución a Fábrica: {{registry?.factoryReturn ? 'Si' : 'No'}}
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>Observaciones:</ion-label>
            <ion-textarea class="text-observations" type="text" rows="4" value="{{registry?.observations}}" readonly="true"></ion-textarea>
          </ion-item>
          <mat-expansion-panel *ngIf="registry?.statusManagementDefect?.requirePhoto && registry?.photos?.length > 0">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Fotos
              </mat-panel-title>
            </mat-expansion-panel-header>
            <ion-item *ngFor="let photo of registry.photos">
              <img src="{{photo.pathMedium}}" alt="" />
            </ion-item>
          </mat-expansion-panel>
          <br/>
          <mat-expansion-panel *ngIf="registry?.statusManagementDefect?.requireOk && registry?.signature?.pathMedium">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Firma
              </mat-panel-title>
            </mat-expansion-panel-header>
            <ion-item>
              <img src="{{registry?.signature?.pathMedium}}" alt="" />
            </ion-item>
          </mat-expansion-panel>
        </ion-list>
    </div>

    <div *ngIf="section == 'historical'">
        <ion-list>
          <div *ngFor="let historical of registryHistorical; let i = index" class="ion-padding">
            <div>
              <p>
                Usuario: {{ historical?.user?.name }}
              </p>
              <p>
                Fecha de Detección: {{ historical?.updatedAt | date:"dd/MM/yyyy HH:mm:ss" }}
              </p>
            </div>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Estado: {{getStatusName(historical.statusManagementDefect.defectType)}}
                </mat-panel-title>
              </mat-expansion-panel-header>
              <ion-list>
                <ion-item>
                  <ion-label>
                    Producto: {{ historical?.product?.reference }}
                  </ion-label>
                </ion-item>
              </ion-list>
              <div *ngIf="getRequireStatus(historical.statusManagementDefect.defectType, 'contact')" class="contact">
                <ion-list>
                  <ion-list-header>
                    <h2>Contacto</h2>
                  </ion-list-header>
                  <ion-item>
                    <ion-label>
                      Nombre: {{ historical?.contact?.name }}
                    </ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>
                      Correo: {{ historical?.contact?.email }}
                    </ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>
                      Teléfono: {{ historical?.contact?.phone }}
                    </ion-label>
                  </ion-item>
                </ion-list>
              </div>
              <mat-expansion-panel class="photos" *ngIf="getRequireStatus(historical.statusManagementDefect.defectType, 'photo') && historical?.photos?.length > 0">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    Fotos
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <ion-item lines="none" *ngFor="let photo of historical.photos">
                  <img src="{{photo.pathMedium}}" alt="" />
                  <ion-item-divider></ion-item-divider>
                </ion-item>
              </mat-expansion-panel>
              <mat-expansion-panel class="signature" *ngIf="getRequireStatus(historical.statusManagementDefect.defectType, 'signature') && historical?.signature?.pathMedium">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    Firma
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <ion-item lines="none">
                  <img src="{{historical?.signature?.pathMedium}}" alt="" />
                </ion-item>
              </mat-expansion-panel>
            </mat-expansion-panel>
          </div>
        </ion-list>
        <ion-item-divider></ion-item-divider>
    </div>
</ion-content>
<ion-footer>
  <ion-toolbar class="ion-text-center">
    <suite-button-change-state [registry]="registry" [showChangeState]="showChangeState"></suite-button-change-state>
  </ion-toolbar>
</ion-footer>
