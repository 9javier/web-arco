<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button matTooltip="Cerrar" matTooltipClass="tooltip" (click)="close()">
        <ion-icon name="close" class="toogleArrow"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ registry?.warehouse?.reference }}/{{registry?.warehouseDefectIdentifier}}</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>
  <ion-segment [(ngModel)]="section">
    <ion-segment-button value="information">
      <ion-label>Información</ion-label>
    </ion-segment-button>
    <ion-segment-button value="historical">
      <ion-label>Histórico</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div *ngIf="section == 'information'">
    <ion-list class="ion-padding">
      <ion-item>
        <ion-label>
          <span>Usuario: {{registry?.user?.name}}</span>
          <span class="ion-float-right">Almacén: {{registry?.warehouse ? (registry?.warehouse.reference + " - " + registry?.warehouse.name) : ""}}</span>
        </ion-label>
      </ion-item>
      <ion-item>
        <ion-label>
          <span>Modelo: {{registry?.product?.model?.reference}}</span>
          <span class="ion-float-right">T: {{registry?.product?.size?.name}}</span>
        </ion-label>
      </ion-item>
      <ion-item>
        <ion-label>
          Marca: {{registry?.product?.model?.brand?.name}}
        </ion-label>
      </ion-item>
      <ion-item>
        <ion-label>
          Producto: {{registry?.product?.reference}}
        </ion-label>
      </ion-item>
      <ion-item *ngIf="registry.statusManagementDefect">
        <ion-label>
          Estado: {{registry.statusManagementDefect.name}}
        </ion-label>
      </ion-item>
      <ion-item *ngIf="registry.defectTypeParent">
        <ion-label>
          Defecto: {{registry?.defectTypeParent?.name}} - {{registry?.defectTypeChild?.name}}
        </ion-label>
      </ion-item>
      <ion-item *ngIf="registry.defectZoneParent">
        <ion-label>
          Zona: {{registry?.defectZoneParent?.name}} - {{registry?.defectZoneChild?.name}}
        </ion-label>
      </ion-item>
      <ion-item class="observations">
        <ion-textarea class="text-observations" type="text" rows="4" value="{{registry?.observations}}" readonly="true">
        </ion-textarea>
      </ion-item>
      <ion-item *ngIf="registry && registry.statusManagementDefect && getRequireStatus(registry.statusManagementDefect, 'contact')" class="contact">
        <ion-list>
          <ion-list-header>
            <h2>Contacto</h2>
          </ion-list-header>
          <ion-item>
            <ion-label>
              Nombre: {{ registry?.contact?.name }}
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              Tlf./Email: {{ registry?.contact?.info }}
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-item>
      <mat-expansion-panel *ngIf="registry?.statusManagementDefect?.requirePhoto && registry?.photos?.length > 0">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Fotos
          </mat-panel-title>
        </mat-expansion-panel-header>
        <ion-item *ngFor="let photo of registry.photos">
          <img src="{{baseUrlPhoto}}{{photo.pathOriginal}}" alt="" />
        </ion-item>
      </mat-expansion-panel>
      <br />
      <mat-expansion-panel *ngIf="registry?.statusManagementDefect?.requireOk && registry?.signature?.pathMedium">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Firma
          </mat-panel-title>
        </mat-expansion-panel-header>
        <ion-item>
          <img src="{{baseUrlPhoto}}{{registry?.signature?.pathMedium}}" alt="" />
        </ion-item>
      </mat-expansion-panel>
    </ion-list>
  </div>

  <div *ngIf="section == 'historical'">
    <ion-list>
      <div *ngFor="let historical of registryHistorical; let i = index" class="ion-padding">
        <div>
          <p>
            Usuario: {{ historical?.user?.name }}
          </p>
          <p>
            Fecha: {{ historical?.updatedAt | date:"dd/MM/yyyy HH:mm:ss" }}
          </p>
        </div>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Estado: {{historical.statusManagementDefect.name}}
            </mat-panel-title>
          </mat-expansion-panel-header>
          <ion-list>
            <ion-item>
              <ion-label>
                Producto: {{ historical?.product?.reference }}
              </ion-label>
            </ion-item>
          </ion-list>
          <div *ngIf="getRequireStatus(historical.statusManagementDefect, 'contact')" class="contact">
            <ion-list>
              <ion-list-header>
                <h2>Contacto</h2>
              </ion-list-header>
              <ion-item>
                <ion-label>
                  Nombre: {{ historical?.contact?.name }}
                </ion-label>
              </ion-item>
              <ion-item>
                <ion-label>
                  Tlf./Email: {{ historical?.contact?.info }}
                </ion-label>
              </ion-item>
            </ion-list>
          </div>
          <mat-expansion-panel class="photos"
            *ngIf="getRequireStatus(historical.statusManagementDefect, 'photo') && historical?.photos?.length > 0">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Fotos
              </mat-panel-title>
            </mat-expansion-panel-header>
            <ion-item lines="none" *ngFor="let photo of historical.photos">
              <img src="{{baseUrlPhoto}}{{photo.pathOriginal}}" alt="" />
              <ion-item-divider></ion-item-divider>
            </ion-item>
          </mat-expansion-panel>
          <mat-expansion-panel class="signature"
            *ngIf="getRequireStatus(historical.statusManagementDefect, 'signature') && historical?.signature?.pathMedium">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Firma
              </mat-panel-title>
            </mat-expansion-panel-header>
            <ion-item lines="none">
              <img src="{{baseUrlPhoto}}{{historical?.signature?.pathMedium}}" alt="" />
            </ion-item>
          </mat-expansion-panel>
        </mat-expansion-panel>
      </div>
    </ion-list>
    <ion-item-divider></ion-item-divider>
  </div>
</ion-content>
<ion-footer>
  <ion-toolbar class="ion-text-center">
    <suite-button-change-state [registry]="registry_data" [showChangeState]="showChangeState">
    </suite-button-change-state>
  </ion-toolbar>
</ion-footer>
