<ion-header>
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-button matTooltip="Cerrar" matTooltipClass="tooltip" (click)="close()">
                <ion-icon name="close" class="toogleArrow"></ion-icon>
            </ion-button>
        </ion-buttons>
        <ion-title>{{ registry.id }}</ion-title>
    </ion-toolbar>
</ion-header>
<ion-content>
    <ion-segment [(ngModel)]="section">
        <ion-segment-button value="information">
            <ion-label>Información</ion-label>
        </ion-segment-button>
        <ion-segment-button value="historical">
            <ion-label>Histórico</ion-label>
        </ion-segment-button>
    </ion-segment>

    <div *ngIf="section == 'information'">
        <ion-list>          
          <ion-item>
            <ion-label>
              Almacén: {{registry?.warehouse ? (registry?.warehouse.reference + " - " + registry?.warehouse.name) : ""}}
            </ion-label>
          </ion-item>          
          <ion-item>
            <ion-label>
              Modelo: {{registry?.product?.model?.name}}
            </ion-label>
          </ion-item>          
          <ion-item>
            <ion-label>
              Talla: {{registry?.product?.size?.name}}
            </ion-label>
          </ion-item>          
          <ion-item>
            <ion-label>
              Producto: {{registry?.product?.reference}}
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              Fecha de Detección: {{registry?.dateDetection | date:"dd/MM/yyyy" }}
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              Observaciones: {{registry?.numberObservations}}
            </ion-label>
          </ion-item>
          <ion-item *ngIf="registry?.factoryReturn">
            <ion-label>
              Devolución a Fábrica: {{registry?.factoryReturn ? 'Si' : 'No'}}
            </ion-label>
          </ion-item>
          <mat-expansion-panel *ngIf="registry?.photos?.length > 0">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Foto
              </mat-panel-title>
            </mat-expansion-panel-header>
            <ion-item *ngFor="let photo of registry.photos">
              <img src="{{photo.pathOriginal}}" alt="" />
            </ion-item>
          </mat-expansion-panel>
        </ion-list>
    </div>

     <div *ngIf="section == 'historical'">
        <ion-list *ngFor="let historical of registryHistorical; let i = index">
            <ion-item >
                <div>
                  <p>
                    Fecha de Detección: {{ historical?.updatedAt | date:"dd/MM/yyyy" }}
                  </p>
                  <p>
                    Producto: {{ historical?.product?.reference }}
                  </p>
                  <p>
                    Estado: {{getStatusName(historical.statusManagementDefect.defectType)}}
                  </p>
                </div>
              <mat-expansion-panel *ngIf="historical?.photos?.length > 0">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    Foto
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <ion-item *ngFor="let photo of historical.photos">
                  <img src="{{photo.pathOriginal}}" alt="" />
                </ion-item>
              </mat-expansion-panel> 
            </ion-item>

            <ion-item>
              <mat-expansion-panel style="width: 100%;">
                <mat-expansion-panel-header>
                  Detalle
                </mat-expansion-panel-header>
                <ion-list>
                  <ion-item>
                    <ion-label>
                      Producto: {{historical?.product?.reference}}
                    </ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>
                      Almacén: {{historical?.warehouse ? (historical?.warehouse.reference + " - " + historical?.warehouse.name) : ""}}
                    </ion-label>
                  </ion-item>                 
                  <ion-item>
                    <ion-label>
                      Modelo: {{historical?.product.model?.name}}
                    </ion-label>
                  </ion-item>          
                  <ion-item>
                    <ion-label>
                      Talla: {{historical?.product?.size?.name}}
                    </ion-label>
                  </ion-item>           
                  <ion-item>
                    <ion-label>
                      Fecha de Detección: {{historical?.dateDetection | date:"dd/MM/yyyy" }}
                    </ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>
                      Observaciones: {{historical?.numberObservations}}
                    </ion-label>
                  </ion-item>
                  <ion-item *ngIf="historical?.factoryReturn">
                    <ion-label>
                      Devolución a Fábrica: {{historical?.factoryReturn ? 'Si' : 'No'}}
                    </ion-label>
                  </ion-item>
                  <mat-expansion-panel *ngIf="historical?.photos?.length > 0">
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        Foto
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <ion-item *ngFor="let photo of historical.photos">
                      <img src="{{photo.pathOriginal}}" alt="" />
                    </ion-item>
                  </mat-expansion-panel>
                </ion-list>
              </mat-expansion-panel>
            </ion-item>

        </ion-list>
        <ion-item-divider></ion-item-divider>
    </div> 
</ion-content>
<ion-footer>
  <ion-toolbar class="ion-text-center">
    <!-- <suite-button-change-state [registry]="registry" [showChangeState]="showChangeState"></suite-button-change-state> -->
    <ion-button (click)="changeState(registry.product.id)">Cambiar estado</ion-button>
    <!-- <ion-button (click)="historic(registry)">Ver histórico</ion-button> -->
  </ion-toolbar>
</ion-footer>
