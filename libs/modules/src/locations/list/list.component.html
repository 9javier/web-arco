<ion-text color="primary">
    <h1>
      <span *ngIf="parentPage" (click)="goPreviousPage()" class="previous-page-link">{{parentPage}} > </span>{{ title }}
      <ion-button class="btn-move-products" slot="end" color="primary" *ngIf="isMainWarehouseManagementSection()" (click)="openModalMoveProducts">
        Mover contenido
      </ion-button>
    </h1>
</ion-text>
<div class="enable-lock-container" *ngIf="!isMainWarehouseManagementSection()">
    <div>
        <ion-button slot="end" color="primary" (click)="openEnableLockContainer()">Desactivar/bloquear ubicaciones</ion-button>
    </div>
</div>
<div class="example-container">
    <table mat-table [dataSource]="dataSource" class="">
        <!-- Position Column -->

        <ng-container *ngFor="let column of dataColumns" matColumnDef="{{column.value}}">
            <th mat-header-cell *matHeaderCellDef>{{ column.name }}</th>
            <td mat-cell *matCellDef="let element; let i = index">
                <span>{{ element[column.value] }}</span>
            </td>
        </ng-container>

        <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let detail" [attr.colspan]="displayedColumns.length" [class.collapsed-detail]="!detail.element.expanded" class="row-element-detail">
                <div [@detailExpand]="detail.element.expanded ? 'expanded' : 'collapsed'" class="detail-wrapper" [style.height]="detail.element.expanded ? 'unset' : '0 !important'">
                    <table class="element-detail">
                        <tr *ngIf="detail.element.container && detail.element.container.length">
                            <td class="location-resume" (click)="selectAllLocations()">
                                <div class="incidence-element-resume">
                                  <i class="material-icons">select_all</i>
                                </div>
                            </td>
                            <td *ngFor="let column of detail.element.container[0]; let iColumn = index" class="location-resume" (click)="selectColumn($event, detail, detail.element.container, iColumn)">
                                <div class="incidence-element-resume">{{column.column}}</div>
                            </td>
                            <td class="location-resume"></td>
                        </tr>
                        <tr *ngFor="let row of detail.element.container | reverse; let iRow = index">
                            <td class="location-resume" (click)="selectRow($event, detail, row, iRow)">
                                <div class="incidence-element-resume">{{row[0].row}}</div>
                            </td>
                            <td *ngFor="let column of row; let iColumn = index" [class.location-free]="column.items == 0 && column.enabled && !column.lock" [class.location-disabled]="!column.enabled" [class.location-locked]="column.enabled && column.lock" (click)="selectLocation($event, detail, row, column, iRow, iColumn)" [class.location-selected]="locationsSelected[column.id]">
                                <div *ngIf="column.enabled && column.items > 0 && column.incidence" class="incidence-element-detail" [class.slight-incidence]="column.incidence == 'slight'" [class.serious-incidence]="column.incidence == 'serious'"></div>
                            </td>
                            <td class="location-resume" (click)="selectRow($event, detail, row, iRow)">
                                <div class="incidence-element-resume">{{row[0].row}}</div>
                            </td>
                        </tr>
                        <tr *ngIf="detail.element.container && detail.element.container.length">
                            <td class="location-resume"></td>
                            <td *ngFor="let column of detail.element.container[0]; let iColumn = index" class="location-resume" (click)="selectColumn($event, detail, column, iColumn)">
                                <div class="incidence-element-resume">{{column.column}}</div>
                            </td>
                            <td class="location-resume"></td>
                        </tr>
                    </table>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns" style="cursor: pointer" [class.expanded]="expandedElement == row" (click)="selectRowToExpand(row)"></tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']; when: isExpansionDetailRow" [@detailExpand]="row == expandedElement ? 'expanded' : 'collapsed'" style="overflow: hidden"></tr>

        <ng-container matColumnDef="icon">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let row" class="row-icon-location">
                <ion-grid>
                    <ion-row>
                        <ion-col>
                            <div class="cell-resume-use"></div>
                        </ion-col>
                        <ion-col>
                            <div class="cell-resume-incidence" [class.cell-incidence-serious]="row.incidence == 'serious'" [class.cell-incidence-slight]="row.incidence == 'slight'"></div>
                            <div class="cell-resume-free" [class.cell-not-free]="row.freeLocations <= 0"></div>
                        </ion-col>
                    </ion-row>
                </ion-grid>
            </td>
        </ng-container>

        <ng-container matColumnDef="update">
            <th mat-header-cell *matHeaderCellDef>update</th>
            <td mat-cell *matCellDef="let row">
                <ion-icon name="create" (click)="toUpdate($event,row)"></ion-icon>
            </td>
        </ng-container>
        <ng-container matColumnDef="dropdown">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let row" (click)="dd($event,row)">
                <ion-icon [name]=" row.dropdown_icon "></ion-icon>
            </td>
        </ng-container>
    </table>
</div>

<ion-row class="fab-row-actions ">
    <ion-col size="1 " size-xs="1 " [offset]="9 " [offsetXs]="9 " *ngIf="origin=='list' && countLocationsSelected> 0">
        <ion-fab [@EnterLeave]="'flyIn'" (click)="selectAllLocations()">
            <ion-fab-button color="light">
                <i class="material-icons">select_all</i>
            </ion-fab-button>
        </ion-fab>
    </ion-col>
    <ion-col size="1" size-xs="1" *ngIf="origin == 'list' && countLocationsSelected > 0">
        <ion-fab [@EnterLeave]="'flyIn'" (click)="disableLocations()">
            <ion-fab-button color="light">
                <i class="material-icons">grid_off</i>
            </ion-fab-button>
        </ion-fab>
    </ion-col>
    <ion-col size="1" size-xs="1" *ngIf="origin == 'list' && countLocationsSelected > 0">
        <ion-fab [@EnterLeave]="'flyIn'" (click)="lockLocations()">
            <ion-fab-button color="light">
                <i class="material-icons">lock</i>
            </ion-fab-button>
        </ion-fab>
    </ion-col>
</ion-row>
