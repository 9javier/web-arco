<!--View to create a new user-->
<ion-header>
  <ion-toolbar color="primary">
      <ion-buttons slot="start">
          <ion-button (click)="close()">
              <ion-icon name="close" class="toogleArrow"></ion-icon>
          </ion-button>
      </ion-buttons>
      <ion-title>Crear Usuario</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>
  <suite-utils></suite-utils>
  <!--Form to update the user-->
  <form *ngIf="updateForm" [formGroup]="updateForm">
      <ion-grid class="wrapper-form">
          <ion-row class="input-wrapper">
              <!--Name-->
              <ion-item class="item" lines="none">
                  <ion-icon slot="start" class="icon" color="medium" name="person"></ion-icon>
                  <ion-label class="label" position="stacked">Nombre</ion-label>
                  <ion-input class="input" formControlName="name" type="text" text></ion-input>
              </ion-item>
              <!--Email-->
              <ion-item class="item" lines="none">
                <ion-icon slot="start" class="icon" color="medium" name="finger-print"></ion-icon>
                <ion-label class="label" position="stacked">Usuario</ion-label>
                <ion-input class="input"  formControlName="email" type="text" text></ion-input>
            </ion-item>
              <!--Password-->
              <ion-item class="item" lines="none">
                <ion-icon slot="start" class="icon" color="medium" name="lock"></ion-icon>
                <ion-label class="label large" position="stacked">Nueva contraseña</ion-label>
                <ion-input class="input"  formControlName="password" type="password"  #passwordInput></ion-input>
                <ion-icon slot="end" class="icon-show-password icon" color="medium" [name]="passwordInput.type === 'password' ? 'eye' : 'eye-off'" (click)="
                    passwordInput.type === 'password'
                      ? (passwordInput.type = 'text')
                      : (passwordInput.type = 'password')
                  "></ion-icon>
            </ion-item>

              <!--Repeat password-->
              <ion-item class="item" lines="none">
                <ion-icon slot="start" class="icon" color="medium" name="lock"></ion-icon>
                <ion-label class="label large" position="stacked">Repetir contraseña</ion-label>
                <ion-input class="input"  formControlName="password" type="text" #repeatPasswordInput></ion-input>
                <ion-icon  slot="end" class="icon-show-password icon" color="medium" [name]="repeatPasswordInput.type === 'password' ? 'eye' : 'eye-off'" (click)="
                repeatPasswordInput.type === 'password'
                    ? (repeatPasswordInput.type = 'text')
                    : (repeatPasswordInput.type = 'password')
                "></ion-icon>
            </ion-item>
              <!--Direction-->
              <ion-item class="item" lines="none">
                <ion-icon slot="start" class="icon" color="medium" name="home"></ion-icon>
                <ion-label class="label" position="stacked">Dirección</ion-label>
                <ion-input class="input"  formControlName="address" type="text" text></ion-input>
            </ion-item>
              <!--Employee Id-->
              <ion-item class="item" lines="none">
                <ion-icon slot="start" class="icon" color="medium" name="lock"></ion-icon>
                <ion-label class="label large" position="stacked">Id empleado Avelon</ion-label>
                <ion-input class="input"  formControlName="employedId" type="number" text></ion-input>
            </ion-item>
               <!--Tiene tienda-->
               <ion-item class="item" lines="none">
                <ion-icon slot="start" class="icon" color="medium" name=""></ion-icon>
                <ion-label class="label large" position="stacked">Id empleado Avelon</ion-label>
                <ion-checkbox  formControlName="hasWarehouse"></ion-checkbox>
            </ion-item>
              <!--Tienda-->

              <ion-item class="inner-item item" style="display: none;">
                  <ion-select placeholder="Tienda" formControlName="warehouseId" [value]="warehouse_id">
                      <ion-select-option *ngFor="let warehouse of warehouses" [value]="warehouse.id">
                          {{warehouse.name}}</ion-select-option>
                  </ion-select>
              </ion-item>

              <!--Warehouses permissions-->
              <div class="container-permits">
                  Permisos:
                  <div [class.error]="updateForm['controls'].permits.touched" class="advise"
                      *ngIf="updateForm['controls'].permits.invalid">
                      Se necesita al menos un almacén, con al menos un rol
                  </div>
                  <div [formGroup]="control"
                      *ngFor="let control of updateForm['controls'].permits['controls'];let i = index"
                      (click)="updateForm['controls'].permits.touched = true">
                      <ion-item
                          [class.invalid]="!updateForm['controls']?.permits?.valid && updateForm['controls'].permits.touched">
                          <mat-accordion multi="false">
                              <mat-expansion-panel>
                                  <mat-expansion-panel-header>
                                      <ion-grid>
                                          <ion-row>
                                              <ion-col size="11">
                                                  <mat-panel-title> {{control.controls.name.value}} </mat-panel-title>
                                              </ion-col>
                                              <ion-col size="1">
                                                  <ion-badge color="danger" *ngIf="!updateForm.value.hasWarehouse" (click)="deletePermision($event,i)">-
                                                  </ion-badge>
                                              </ion-col>
                                          </ion-row>
                                      </ion-grid>
                                  </mat-expansion-panel-header>
                                  <div>
                                      <ion-item
                                          *ngFor="let control of control['controls'].roles['controls'];let i = index">
                                          <ion-label>{{roles[i].name}}</ion-label>
                                          <ion-checkbox value="{{roles[i].id}}" [formControl]="control">
                                          </ion-checkbox>
                                      </ion-item>
                                  </div>
                                  <mat-list style="display: flex; justify-content:center;"></mat-list>
                              </mat-expansion-panel>
                          </mat-accordion>
                      </ion-item>
                  </div>
                  <div>
                      <ion-button (click)="selectNewWarehouse(addWarehouseToUser)" *ngIf="!updateForm.value.hasWarehouse">Agregar permiso +</ion-button>
                  </div>
              </div>
          </ion-row>
      </ion-grid>
  </form>
</ion-content>
<ion-footer>
  <ion-toolbar>
      <ion-button slot="end" color="light" (click)="close()">Cancelar</ion-button>
      <ion-button slot="end" color="primary" [disabled]="updateForm.invalid" (click)="submit()">Guardar</ion-button>
  </ion-toolbar>
</ion-footer>
<!--<suite-ui-crud-store
[title]="title"
[formBuilderDataInputs]="formBuilderDataInputs"
[formBuilderTemplateInputs]="formBuilderTemplateInputs"
[apiEndpoint]="apiEndpoint"
[redirectTo]="redirectTo"
[customValidators]="customValidators"
></suite-ui-crud-store>
-->
